name: Build and Release Helpers Plugin

on:
  push:
    paths:
      - 'main.ts'

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Required to publish release

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install build tools
        run: npm install -g esbuild typescript

      - name: Create plugin folder
        run: mkdir -p helpers-plugin

      - name: Compile TypeScript
        run: esbuild main.ts --bundle --platform=node --external:obsidian --outfile=helpers-plugin/main.js

      - name: Add manifest and styles
        run: |
          echo '{
            "id": "helpers-plugin",
            "name": "Helpers Plugin",
            "version": "1.0.0",
            "minAppVersion": "0.15.0",
            "description": "Reusable helper functions for Obsidian scripts",
            "author": "Your Name",
            "authorUrl": "",
            "isDesktopOnly": true
          }' > helpers-plugin/manifest.json

          echo '' > helpers-plugin/styles.css

      - name: Zip compiled plugin
        run: zip -r helpers-plugin.zip helpers-plugin

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: Helpers Plugin v1.0.0
          tag_name: v1.0.0
          files: helpers-plugin.zip
